import{c as b,t as g,d as y,e as k,I as p,V as j,J as w,Y as P,K as C,b as h,Q as f,r as v,u as U,a as x,j as a}from"./index-fe10a68b.js";import{L as E}from"./Line-5939b8ec.js";import{M as L}from"./ModalWindow-692bcdc1.js";import{B as S}from"./ButtonClose-d160668c.js";import{v as B}from"./v4-4a60fe23.js";import"./useResizeWindow-c24fab42.js";import"./objectWithoutPropertiesLoose-68193569.js";import"./useCloseModal-02386773.js";import"./sprite-f03adbee.js";const N=async(e,r,s,n)=>{await b(e,{photoURL:r}),await g(y(k,"users",s),{photoURL:r}),n(e)},R=async e=>{if(e){const r=p(w,e);await j(r)}},$=async(e,r,s)=>{const n={contentType:e.type},l=p(w,`${e.type}/${r}/${B()}-${e.name}`),d=new Blob([e]),i=P(l,d,n);return new Promise((c,o)=>{i.on("state_changed",t=>{const u=t.bytesTransferred/t.totalBytes*100;s(u)},t=>{o(new Error(`Error uploading file: ${t.message}`))},async()=>{try{const t=await C(i.snapshot.ref);c(t)}catch(t){t instanceof Error?o(new Error(`Failed to get download URL: ${t.message}`)):o(new Error("Failed to get download URL: An unknown error occurred"))}})})},F=async(e,r,s,n,l,d,i)=>{var o;if(!((o=e.current)!=null&&o.files)||!h.currentUser||!r)return;const c=e.current.files[0];if(c)try{const t=await $(c,r,s);await R(l),await N(h.currentUser,t,r,d),i(),s(null),f.success(n("ChangePhotoToastSuccess"))}catch(t){f.error(n("ChangePhotoToastError")),console.error("Error updating profile photo:",t)}},K=({photoProfileInputRef:e,handleToggleProfilePhotoModal:r})=>{var o,t,u;const[s,n]=v.useState(null),{t:l}=U("translation",{keyPrefix:"ProfileSettings"}),{uid:d,photoURL:i}=x(m=>m.currentUser),c=x(m=>m.updateCurrentUser);return a.jsx(L,{handleToggleModal:r,children:a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsxs("div",{className:"relative flex h-2/3 w-full flex-col items-center justify-center gap-6 rounded-3xl bg-main shadow-mainShadow dark:bg-mainBlack sm:w-1/2 xl:w-1/3",children:[a.jsx(S,{handleClickButtonClose:r}),((o=e.current)==null?void 0:o.files)&&a.jsx("div",{className:"h-200px w-200px",children:a.jsx("img",{className:"h-full w-full rounded-full object-cover",src:URL.createObjectURL((t=e.current)==null?void 0:t.files[0]),alt:(u=e.current)==null?void 0:u.files[0].name,width:200,height:200})}),a.jsx("p",{className:"w-80 text-center text-xs text-black dark:text-white",children:l("Modal.ChangeProfilePhotoPrompt")}),a.jsx("button",{className:"w-48 rounded-3xl border-2 border-black text-black transition-all duration-300 hover:bg-mediumZinc hover:shadow-mainShadow disabled:text-darkZinc dark:border-white dark:text-white hover:dark:bg-extraDarkGray",type:"button",onClick:()=>F(e,d,n,l,i,c,r),"aria-label":"Update profile photo",disabled:typeof s=="number",children:l("Modal.ChangeProfilePhoto")}),a.jsx("div",{className:"flex h-4 items-center gap-4",children:typeof s=="number"&&a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-black dark:text-white",children:"Loading:"}),a.jsx(E,{style:{width:150},percent:s,strokeWidth:6,strokeColor:"#5ee987",trailColor:"#5f5f5f"})]})})]})})})};export{K as default};
