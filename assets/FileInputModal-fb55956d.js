import{j as t,F as v,T as D,i as N,e as S,I as U,J as C,Y as $,K as R,r as h,u as B,a as y}from"./index-1dbf5670.js";import{B as L}from"./ButtonClose-abd96f0a.js";import{F as M,d as A,M as T}from"./ChatPage-df9b8a98.js";import{L as f}from"./Line-98bfbd96.js";import{M as E}from"./ModalWindow-8020d4f8.js";import{v as I}from"./v4-4a60fe23.js";import"./sprite-f89b8981.js";import"./useCloseModal-32ba7e76.js";import"./FileInput-5d4d35cc.js";import"./useResizeWindow-7f7b4e96.js";import"./convertTimeWithZero-0e4ead24.js";import"./objectWithoutPropertiesLoose-68193569.js";const P=({fileType:e,file:a,status:s})=>t.jsxs("li",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("span",{className:"w-12",children:t.jsx(M,{extension:e,...A[e]})}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("p",{className:"w-24 text-white 2xl:w-64",children:a.name}),t.jsx("p",{className:"text-veryDarkGray",children:(a.size/1024).toFixed(2)+" KB"})]})]}),s>=0&&t.jsx(f,{style:{width:150},percent:s,strokeWidth:6,strokeColor:"#5ee987"})]},a.name),G=({file:e,status:a})=>t.jsxs("li",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("img",{src:URL.createObjectURL(e),alt:`Image ${e.name}`,width:48,height:48}),t.jsxs("div",{className:"flex flex-col",children:[t.jsx("p",{className:"w-24 text-black dark:text-white 2xl:w-64",children:e.name}),t.jsx("p",{className:"text-mediumGray",children:(e.size/1024).toFixed(2)+" KB"})]})]}),a>=0&&t.jsx(f,{style:{width:150},percent:a,strokeWidth:6,strokeColor:"#5ee987"})]},e.name),O=async(e,a,s,o)=>{const n=`${String.fromCodePoint(128206)} ${e.length} file(s)`;await v(N(S,`chats/${s}/messages`),{type:T.AttachedFiles,file:e,fileDescription:n,message:o||"",senderUserID:a,date:D.now(),isRead:!1,isEdited:!1,isShowNotification:!0})},K=(e,a,s)=>new Promise((o,n)=>{const l={contentType:e.type},m=U(C,`${e.type}/${a}/${I()}-${e.name}`),d=new Blob([e]),c=$(m,d,l);c.on("state_changed",i=>W(i,e.name,s),i=>n(new Error(`Error uploadTask.on: ${i.message}`)),async()=>{try{const i=await R(c.snapshot.ref),u=await z(e,d,i);o(u)}catch(i){i instanceof Error?n(new Error(`Failed to get download URL and fileDetails: ${i.message}`)):n(new Error("Failed to get download URL and fileDetails: An unknown error occurred"))}})}),W=(e,a,s)=>{const o=e.bytesTransferred/e.totalBytes*100;s(n=>({...n,[a]:o}))},z=(e,a,s)=>new Promise((o,n)=>{if(e.type.includes("image")){const l=new Image;l.src=URL.createObjectURL(a),l.onload=()=>{o({type:e.type,name:e.name,url:s,width:l.width,height:l.height})},l.onerror=n}else o({type:e.type,name:e.name,url:s})}),Z=async(e,a,s,o,n,l,m)=>{var d;if(e&&"current"in e&&((d=e.current)!=null&&d.files)&&a){try{const c=Array.from(e.current.files).map(u=>K(u,s,n)),i=await Promise.all(c);await O(i,a,o,l)}catch(c){console.error("error handleSendFilesToStorage",c)}n({}),m()}},re=h.forwardRef(({setIsModalAddFileOpen:e,handleToggleModal:a},s)=>{var x,w,g;const[o,n]=h.useState(""),[l,m]=h.useState({}),d=h.useRef(null),{t:c}=B("translation",{keyPrefix:"FileInput"}),i=y(r=>r.currentUser.uid),{chatUID:u,userUID:j}=y(r=>r.currentChatInfo),p=()=>{e(!1),o&&n(""),s&&"current"in s&&s.current&&(s.current.value="")},b=async r=>{r.preventDefault(),await Z(s,i,j,u,m,o,p)},k=r=>{n(r.target.value)};return t.jsx(E,{handleToggleModal:a,children:t.jsx("div",{className:"flex h-full items-center justify-center",children:t.jsxs("div",{className:"relative flex h-1/2 w-full flex-col items-center justify-between gap-8 rounded-3xl bg-main p-2 shadow-mainShadow dark:bg-mainBlack sm:w-1/2 xl:w-1/3",children:[t.jsx("p",{className:"font-extrabold text-black dark:text-white",children:`${c("Send")} ${s&&"current"in s&&((w=(x=s.current)==null?void 0:x.files)==null?void 0:w.length)} ${c("Files")}`}),t.jsx(L,{handleClickButtonClose:p}),t.jsx("div",{ref:d,className:"h-full w-full overflow-scroll",children:t.jsx("ul",{className:"flex flex-col gap-2",children:s&&"current"in s&&((g=s.current)==null?void 0:g.files)&&Array.from(s.current.files).map(r=>{if(r.type.includes("image"))return t.jsx(G,{status:l[r.name],file:r},r.name);{const F=r.name.split(".").pop()||"default";return t.jsx(P,{file:r,fileType:F,status:l[r.name]},r.name)}})})}),t.jsxs("form",{className:"flex h-8 w-full items-center gap-4 px-6",onSubmit:b,children:[t.jsx("div",{className:"relative h-10 w-full sm:w-8/12",children:t.jsx("input",{className:"h-full w-full rounded-3xl border-2 border-transparent bg-mediumDarkZinc px-10 py-1 text-white outline-none focus:border-mediumDarkCyan dark:bg-darkBackground",type:"text",placeholder:c("ImageCaptionPlaceholder"),value:o,onChange:k})}),t.jsx("button",{className:"rounded-full border border-veryDarkGray px-2 py-1 text-black transition-all duration-300 hover:bg-mediumZinc hover:shadow-mainShadow dark:text-white hover:dark:bg-extraDarkGray",type:"submit",disabled:Object.keys(l).length>0,"aria-label":"Send",children:c("Send")})]})]})})})});export{re as default};
